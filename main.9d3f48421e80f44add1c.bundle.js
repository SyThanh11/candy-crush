(()=>{"use strict";var e,t={818:(e,t,i)=>{i(440);const s={score:0,highscore:0,gridWidth:8,gridHeight:8,tileWidth:64,tileHeight:64,candyTypes:["jellyYellow","jellyBlack","jellyPink","jellyBlue","jellyRed","jellyGreen"],fallSpeed:.3,swapSpeed:200,delayShowHint:9e3,delayShowIdle:6e3,sizeBackgroundWidth:512,sizeBackgroundHeight:512,scale:.6,addScore:20};class r extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload"),this.load.atlas("flares","https://labs.phaser.io/assets/particles/flares.png","https://labs.phaser.io/assets/particles/flares.json")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}class h extends Phaser.GameObjects.Container{constructor(e,t,i){super(e,t,i);const s=new Phaser.GameObjects.Image(e,0,0,"background").setOrigin(0,0);s.setScale(.16),this.add(s),e.add.existing(this)}}const n=h,a=class{static fadeIn(e,t,i=500,s,r){return e.tweens.add({targets:t,alpha:1,duration:i,ease:s,onComplete:()=>{r&&r()}})}static fadeOutAndZoomIn(e,t,i=100,r,h,n){const a=null==h?void 0:h.x,l=null==h?void 0:h.y,o=a+.5*s.tileWidth/2,d=l+.5*s.tileHeight/2;return e.tweens.add({targets:t,alpha:0,x:o,y:d,scale:.5,duration:i,ease:r,onComplete:()=>{n&&n()}})}static moveTo(e,t,i,s,r=500,h,n){return e.tweens.add({targets:t,x:i,y:s,duration:r,ease:h,onComplete:()=>{n&&n()}})}static clickToScale(e,t,i,s,r,h,n=500,a,l=!1,o){return e.tweens.add({targets:t,x:i,y:s,scaleX:r,scaleY:h,duration:n,ease:a,yoyo:l,onComplete:()=>{o&&o()}})}static shuffleCircle(e,t,i,s,r=1500,h=!0,n=0,a,l){return e.tweens.add({targets:t,radius:i,ease:s,duration:r,yoyo:h,repeat:n,onUpdate:()=>{a&&a()},onComplete:()=>{l&&l()}})}};class l{constructor(){this.currentScore=0,this.targetScore=1e3,this.eventEmitter=new Phaser.Events.EventEmitter}static getInstance(){return l.instance||(l.instance=new l),l.instance}incrementScore(e){this.currentScore+=e,this.isTargetScoreReached()&&this.eventEmitter.emit("reachTargetScore")}getCurrentScore(){return this.currentScore}isTargetScoreReached(){return this.currentScore>=this.targetScore}resetScore(){this.currentScore=0}getTargetScore(){return this.targetScore}setTargetScore(e){this.targetScore=e}getProgressRatio(){return this.currentScore/this.targetScore}}const o=l,d=class{constructor(e){this.matchTiles=[],this.tileGrid=e}getMatchTiles(){return this.matchTiles}setMatchTiles(e){this.matchTiles=e}addTile(e){if(0==this.matchTiles.length)return this.matchTiles.push(e),this.centerTile=e,!0;if(this.matchTiles.includes(e))return!0;for(let t=0;t<this.matchTiles.length;t++)if(this.canMatch(this.matchTiles[t],e))return this.matchTiles.push(e),this.centerTile=this.findCenter(this.tileGrid,this.matchTiles),!0;return!1}canMatch(e,t){if(e.hasSameTypeTile(t)&&(this.centerTile.getBoardX()==t.getBoardX()||this.centerTile.getBoardY()==t.getBoardY())){if(e.getBoardX()+1==t.getBoardX()&&e.getBoardY()==t.getBoardY())return!0;if(e.getBoardX()==t.getBoardX()&&e.getBoardY()+1==t.getBoardY())return!0;if(e.getBoardX()-1==t.getBoardX()&&e.getBoardY()==t.getBoardY())return!0;if(e.getBoardX()==t.getBoardX()&&e.getBoardY()-1==t.getBoardY())return!0}return!1}destroyAllTiles(e){for(let t=this.matchTiles.length-1;t>=0;t--){const i=this.matchTiles[t];if(4==i.getMatchCount())return void this.handleBoomMatchFour(i,e);if(i.getMatchCount()>=5)return void this.handleBoomMatchFive(i,e)}for(let t=this.matchTiles.length-1;t>=0;t--){const i=this.matchTiles[t];e[i.getBoardY()][i.getBoardX()]=void 0,i.destroyTile(),o.getInstance().eventEmitter.emit("addScore",s.addScore)}}handleBoomMatchFour(e,t){if(e.getIsHorizontal())for(let i=0;i<s.gridWidth;i++){const r=t[e.getBoardY()][i];t[e.getBoardY()][i]=void 0,null==r||r.destroyTile(),o.getInstance().eventEmitter.emit("addScore",s.addScore)}else for(let i=0;i<s.gridHeight;i++){const r=t[i][e.getBoardX()];t[i][e.getBoardX()]=void 0,null==r||r.destroyTile(),o.getInstance().eventEmitter.emit("addScore",s.addScore)}t[e.getBoardY()][e.getBoardX()]=void 0,e.destroyTile()}handleBoomMatchFive(e,t){const i=e.getBoardX(),r=e.getBoardY();for(let e=r-1;e<=r+1;e++)for(let r=i-1;r<=i+1;r++)if(e>=0&&e<s.gridHeight&&r>=0&&r<s.gridWidth){const i=t[e][r];i&&(t[e][r]=void 0,i.destroyTile(),o.getInstance().eventEmitter.emit("addScore",s.addScore))}t[e.getBoardY()][e.getBoardX()]=void 0,e.destroyTile(),o.getInstance().eventEmitter.emit("addScore",s.addScore)}playTween(){this.matchTiles.forEach((e=>{e.test()}))}findCenter(e,t){let i=-1,r=-1,h=t[0];for(let n=0;n<t.length-1;n++){const a=t[n],l=a.getBoardX()+1,o=a.getBoardX()-1,d=a.getBoardY()-1,c=a.getBoardY()+1;let g=!1,u=!1;if(l<s.gridWidth){const s=e[a.getBoardY()][l];t.includes(s)&&(i++,g=!0)}if(o>=0){const s=e[a.getBoardY()][o];t.includes(s)&&(i++,g=!0)}if(c<s.gridHeight){const s=e[c][a.getBoardX()];t.includes(s)&&(i++,u=!0)}if(d>=0){const s=e[d][a.getBoardX()];t.includes(s)&&(i++,u=!0)}u&&g&&i++,i>=r&&(r=i,h=a),i=-1}return h}mergeTiles(e,t=void 0){const i=this.findCenter(e,this.matchTiles),r=[],h=[],n=[];this.countTiles=0;for(let e=0;e<this.matchTiles.length;e++){const t=this.matchTiles[e];t!=i&&(t.getBoardX()==i.getBoardX()||t.getBoardY()==i.getBoardY()?(r.push({x:t.getBoardX(),y:t.getBoardY()}),h.push(t)):n.push(t))}return h.forEach((s=>{a.moveTo(s.scene,s,i.x,i.y,200,"Linear",(()=>{this.countTiles++,i.setMatchCount(this.countTiles),this.countTiles==h.length&&(r.forEach((t=>{const i=e[t.y][t.x];e[t.y][t.x]=void 0,null==i||i.destroyTile()})),t&&t())}))})),o.getInstance().eventEmitter.emit("addScore",(h.length+1)*s.addScore),i.setMatchCount(h.length),i.toggleGlow(!0),1}},c=class{constructor(e){this.matchManager=[new d(e)],this.tileGrid=e}addTile(e){for(let t=0;t<this.matchManager.length;t++)if(this.matchManager[t].addTile(e))return;const t=new d(this.tileGrid);t.addTile(e),this.matchManager.push(t)}playTween(){this.matchManager.forEach((e=>{e.playTween()}))}refactorMatch(){return new Promise((e=>{for(let e=this.matchManager.length-1;e>=0;e--){const t=this.matchManager[e].getMatchTiles();if(t.length<3){for(let e=0;e<t.length;e++)this.addTile(t[e]);this.matchManager.splice(e,1)}}e()}))}matchAndRemoveTiles(e,t=void 0){let i=0;for(let s=this.matchManager.length-1;s>=0;s--){const r=this.matchManager[s].getMatchTiles();3==r.length?this.matchManager[s].destroyAllTiles(e):r.length>3&&(i+=this.matchManager[s].mergeTiles(e,(()=>{i--,0===i&&t&&t()}))),this.matchManager.splice(s,1)}0===i&&t&&t()}},g=class{constructor(e){this.tileGroup=new Phaser.GameObjects.Group(e),this.circle=new Phaser.Geom.Circle(s.sizeBackgroundWidth/2-s.tileWidth/2,s.sizeBackgroundHeight/2-s.tileHeight/2,64)}playSuffle(e,t){Phaser.Actions.PlaceOnCircle(this.tileGroup.getChildren(),this.circle),a.shuffleCircle(e,this.circle,200,"Quintic.easeInOut",1e3,!0,0,(()=>{Phaser.Actions.RotateAroundDistance(this.tileGroup.getChildren(),{x:s.sizeBackgroundWidth/2-s.tileWidth/2,y:s.sizeBackgroundHeight/2-s.tileHeight/2},.05,this.circle.radius)}),t)}addTile(e){this.tileGroup.add(e)}removeTile(e){this.tileGroup.remove(e)}};class u extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.matchCount=1,this.isHorizontal=!0,this.setOrigin(0,0),this.setInteractive(),this.initGlow(),e.scene.add.existing(this)}setIsHorizontal(e){this.isHorizontal=e}getIsHorizontal(){return this.isHorizontal}setMatchCount(e){this.matchCount=e+1}getMatchCount(){return this.matchCount}initAnimationExpode(){return this.scene.add.particles(.6*this.x+s.tileWidth/2+85,.6*this.y+s.tileHeight/2+140,"flares",{frame:["red","yellow","green"],lifespan:600,speed:{min:50,max:60},scale:{start:.3*s.scale,end:0},gravityY:30,blendMode:"ADD",emitting:!1})}destroyTile(){this.initAnimationExpode().explode(16),a.fadeOutAndZoomIn(this.scene,this,200,"Linear",this,(()=>{this.destroy()}))}hasSameTypeTile(e){return this.texture.key===e.texture.key}getBoardX(){return Math.floor(this.x/s.tileWidth)}getBoardY(){return Math.floor(this.y/s.tileHeight)}test(){this.scene.add.tween({targets:this,scale:1.2,duration:1e3,ease:"Linear",yoyo:!0,repeat:-1})}toggleGlow(e){this.glow&&(this.glow.setActive(e),this.scene.tweens.add({targets:this.glow,outerStrength:10,yoyo:!0,loop:-1,ease:"sine.inout"}))}initGlow(){var e,t,i;null===(e=this.preFX)||void 0===e||e.setPadding(32),this.glow=null===(t=this.preFX)||void 0===t?void 0:t.addGlow(),null===(i=this.glow)||void 0===i||i.setActive(!1)}}const p=u;var f=function(e,t,i,s){return new(i||(i=Promise))((function(r,h){function n(e){try{l(s.next(e))}catch(e){h(e)}}function a(e){try{l(s.throw(e))}catch(e){h(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}l((s=s.apply(e,t||[])).next())}))};class m extends Phaser.GameObjects.Container{constructor(e,t,i){super(e,t,i),this.isPlaying=!0,this.timeSinceInteraction=0,this.timeSinceIdle=0,this.shuffleTiles=new g(e),this.scene.add.existing(this)}init(){this.canMove=!0,this.isPlaying=!0,this.tileGrid=[];for(let e=s.gridHeight-1;e>=0;e--)for(let t=0;t<s.gridWidth;t++){const i=this.scene.add.image(t*s.tileWidth,e*s.tileHeight,"ground").setOrigin(0).setScale(.4);this.add(i)}for(let e=s.gridHeight-1;e>=0;e--){this.tileGrid[e]=[];for(let t=0;t<s.gridWidth;t++){const i=this.addTile(t,e);this.tileGrid[e][t]=i,this.shuffleTiles.addTile(i)}}this.shuffleTiles.playSuffle(this.scene,(()=>{let e=s.gridWidth*s.gridHeight;this.canMove=!1;for(let t=s.gridHeight-1;t>=0;t--)for(let i=0;i<s.gridWidth;i++){const r=t*s.tileHeight+s.tileHeight*(s.gridHeight-t);a.moveTo(this.scene,this.tileGrid[t][i],i*s.tileWidth,t*s.tileHeight,r,"Linear",(()=>{e--,0==e&&(this.resetTimeHintAndIdle(),this.checkMatches(),this.canMove=!0)}))}})),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.scene.input.on("gameobjectdown",this.tileSelect,this),this.scene.input.on("pointermove",this.startSwipe,this),this.scene.input.on("pointerup",this.stopSwipe,this)}restart(){return f(this,void 0,void 0,(function*(){return this.destroyAllTiles((()=>{})).then((()=>{this.init()})).then((()=>{this.isPlaying=!0}))}))}setIsPlaying(e){this.isPlaying=e}preUpdate(e,t){this.canMove&&(this.timeSinceInteraction+=t,this.timeSinceIdle+=t,this.timeSinceInteraction>=s.delayShowIdle&&(this.triggerIdle(),this.timeSinceInteraction=0),this.timeSinceIdle>=s.delayShowHint&&(this.removeHint(),this.showHint(),this.timeSinceIdle=0))}triggerIdle(){for(let e=0;e<s.gridHeight;e++)for(let t=0;t<s.gridWidth;t++){const i=this.tileGrid[e][t];i&&this.scene.tweens.add({targets:i,alpha:.5,duration:1e3,ease:"Linear",yoyo:!0,delay:200*t})}}removeIdleAnimations(){for(let e=0;e<s.gridHeight;e++)for(let t=0;t<s.gridWidth;t++){const i=this.tileGrid[e][t];i&&(this.scene.tweens.killTweensOf(i),i.setAlpha(1))}}showHint(){let e=!1;for(let t=0;t<s.gridHeight;t++)for(let i=0;i<s.gridWidth;i++){if(e)return;if(i<s.gridWidth-1){if(this.swapTilesInGrid(i,t,i+1,t),this.hasMatchAfterSwap()){this.highlightTile(i,t),this.highlightTile(i+1,t),this.swapTilesInGrid(i,t,i+1,t),e=!0;continue}this.swapTilesInGrid(i,t,i+1,t)}if(t<s.gridHeight-1){if(this.swapTilesInGrid(i,t,i,t+1),this.hasMatchAfterSwap()){this.highlightTile(i,t),this.highlightTile(i,t+1),this.swapTilesInGrid(i,t,i,t+1),e=!0;continue}this.swapTilesInGrid(i,t,i,t+1)}}e||this.restart()}highlightTile(e,t){const i=this.tileGrid[t][e];if(i){const e=this.scene.add.image(i.x,i.y,"backgroundClick").setOrigin(0);i.setData("selectionImage",e),this.add(e)}}swapTilesInGrid(e,t,i,s){const r=this.tileGrid[t][e];this.tileGrid[t][e]=this.tileGrid[s][i],this.tileGrid[s][i]=r}hasMatchAfterSwap(){return this.getMatches(this.tileGrid).length>0}removeHint(){for(let e=0;e<s.gridHeight;e++)for(let t=0;t<s.gridWidth;t++){const i=this.tileGrid[e][t];if(i){const e=i.getData("selectionImage");e&&(e.destroy(),i.setData("selectionImage",null))}}}tileSelect(e,t){var i;if(this.canMove){this.canDrag=!0,this.resetTimeHintAndIdle(),this.removeIdleAnimations(),this.removeHint();const e=t.y/s.tileHeight,r=t.x/s.tileWidth;if(e>=s.gridHeight||r>=s.gridWidth||e<0||r<0)return;const h=this.tileGrid[e][r];if(null!=h)if(null==this.firstSelectedTile)this.firstSelectedTile=h,this.canMove=!1,this.clickEffect(this.firstSelectedTile,(()=>{this.canMove=!0}));else{if(this.secondSelectedTile=h,this.firstSelectedTile==this.secondSelectedTile)return void this.tileUp();{const e=Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x)/s.tileWidth,t=Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y)/s.tileHeight;1===e&&0===t||0===e&&1===t?(this.canMove=!1,null===(i=this.currentSelectionImage)||void 0===i||i.destroy(),this.currentSelectionImage=void 0,this.swapTiles()):(this.tileUp(),this.firstSelectedTile=h,this.canMove=!1,this.clickEffect(this.firstSelectedTile,(()=>{this.canMove=!0})))}}}}startSwipe(e){var t;if(this.canDrag&&null!=this.firstSelectedTile){this.resetTimeHintAndIdle();const i=e.downX-e.x,r=e.downY-e.y;let h=0,n=0;if(i>s.tileWidth*s.scale/2&&Math.abs(r)<s.tileWidth*s.scale/4?n=-1:i<-s.tileWidth*s.scale/2&&Math.abs(r)<s.tileWidth*s.scale/4?n=1:r>s.tileHeight*s.scale/2&&Math.abs(i)<s.tileHeight*s.scale/4?h=-1:r<-s.tileHeight*s.scale/2&&Math.abs(i)<s.tileHeight*s.scale/4&&(h=1),0!==h||0!==n){const e=this.getTileRow(this.firstSelectedTile)+h,i=this.getTileCol(this.firstSelectedTile)+n;e>=0&&e<s.gridHeight&&i>=0&&i<s.gridWidth&&(this.secondSelectedTile=this.tileGrid[e][i],null!=this.secondSelectedTile&&(null===(t=this.currentSelectionImage)||void 0===t||t.destroy(),this.currentSelectionImage=void 0,this.swapTiles(),this.canDrag=!1))}}}stopSwipe(){this.canDrag=!1}getTileRow(e){return Math.floor(e.y/s.tileHeight)}getTileCol(e){return Math.floor(e.x/s.tileWidth)}clickEffect(e,t){const i=e.x,r=e.y,h=i-.2*s.tileWidth/2,n=r-.2*s.tileHeight/2;a.clickToScale(this.scene,e,h,n,1.2,1.2,200,"Linear",!0,t),this.currentSelectionImage=this.scene.add.image(e.x,e.y,"backgroundClick").setOrigin(0),this.add(this.currentSelectionImage)}addTile(e,t){const i=s.candyTypes[Phaser.Math.RND.between(0,s.candyTypes.length-1)],r=new p({scene:this.scene,x:e*s.tileWidth,y:t*s.tileHeight,texture:i});return this.add(r),r}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){const e={x:this.firstSelectedTile.x,y:this.firstSelectedTile.y},t={x:this.secondSelectedTile.x,y:this.secondSelectedTile.y};this.tileGrid[e.y/s.tileHeight][e.x/s.tileWidth]=this.secondSelectedTile,this.tileGrid[t.y/s.tileHeight][t.x/s.tileWidth]=this.firstSelectedTile,a.moveTo(this.scene,this.firstSelectedTile,this.secondSelectedTile.x,this.secondSelectedTile.y,s.swapSpeed,"Linear"),a.moveTo(this.scene,this.secondSelectedTile,this.firstSelectedTile.x,this.firstSelectedTile.y,s.swapSpeed,"Linear",(()=>{this.checkMatches()})),this.firstSelectedTile=this.tileGrid[e.y/s.tileHeight][e.x/s.tileWidth],this.secondSelectedTile=this.tileGrid[t.y/s.tileHeight][t.x/s.tileWidth]}}checkMatches(){return f(this,void 0,void 0,(function*(){const e=this.getMatches(this.tileGrid);e.length>0?yield this.removeTileGroup(e):(this.swapTiles(),this.tileUp(),this.canMove=!0)}))}resetTile(){return f(this,void 0,void 0,(function*(){const e=new Map;for(let t=0;t<this.tileGrid.length;t++)for(let i=0;i<this.tileGrid[t].length;i++)if(this.tileGrid[t][i]&&t+1<this.tileGrid.length&&void 0===this.tileGrid[t+1][i])if(e.has(i)){const s=e.get(i);s&&(s[0]=t)}else e.set(i,[t,-1]);else if(void 0===this.tileGrid[t][i])if(e.has(i)){const s=e.get(i);s&&(s[1]=t)}else e.set(i,[-1,t]);const t=[];e.forEach(((e,i)=>{let r=e[1];for(let h=e[0];h>=0;h--){if(null==this.tileGrid[h][i])continue;const e=s.tileHeight*(r-h)/s.fallSpeed;t.push(this.tweenTile(this.tileGrid[h][i],i,r,e));const n=this.tileGrid[h][i];this.tileGrid[h][i]=this.tileGrid[r][i],this.tileGrid[r][i]=n,r--}for(let e=r;e>=0;e--){const h=e-r-1,n=this.addTile(i,h),a=s.tileHeight*(r+1)/s.fallSpeed;t.push(this.tweenTile(n,i,e,a)),this.tileGrid[e][i]=n}})),yield Promise.all(t)}))}tweenTile(e,t,i,r){return new Promise((h=>{a.moveTo(this.scene,e,t*s.tileWidth,i*s.tileHeight,r,"easeInSine",(()=>{h()}))}))}tileUp(){var e;return f(this,void 0,void 0,(function*(){this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,null===(e=this.currentSelectionImage)||void 0===e||e.destroy(),this.currentSelectionImage=void 0}))}removeTileGroup(e){return f(this,void 0,void 0,(function*(){const t=new c(this.tileGrid);for(let i=0;i<e.length;i++){const s=e[i];for(let e=0;e<s.length;e++){const i=s[e];t.addTile(i)}}yield t.refactorMatch(),this.isPlaying&&(yield new Promise((e=>{t.matchAndRemoveTiles(this.tileGrid,(()=>{this.resetTimeHintAndIdle(),this.resetTile().then((()=>{this.tileUp().then((()=>{this.checkMatches().then((()=>{e()}))}))}))}))})))}))}getTilePos(e,t){const i={x:-1,y:-1};for(let s=0;s<e.length;s++)for(let r=0;r<e[s].length;r++)if(t===e[s][r]){i.x=r,i.y=s;break}return i}getMatches(e){var t,i,s,r,h,n,a,l;const o=[];let d=[];for(let h=0;h<e.length;h++){const n=e[h];d=[];for(let a=0;a<n.length;a++)a<n.length-2&&e[h][a]&&e[h][a+1]&&e[h][a+2]&&(null===(t=e[h][a])||void 0===t?void 0:t.texture.key)===(null===(i=e[h][a+1])||void 0===i?void 0:i.texture.key)&&(null===(s=e[h][a+1])||void 0===s?void 0:s.texture.key)===(null===(r=e[h][a+2])||void 0===r?void 0:r.texture.key)&&(d.length>0&&-1==d.indexOf(e[h][a])&&(o.push(d),d=[]),-1==d.indexOf(e[h][a])&&d.push(e[h][a]),-1==d.indexOf(e[h][a+1])&&d.push(e[h][a+1]),-1==d.indexOf(e[h][a+2])&&d.push(e[h][a+2]));d.length>0&&o.push(d)}for(let t=0;t<e.length;t++){const i=e[t];d=[];for(let s=0;s<i.length;s++)s<i.length-2&&e[s][t]&&e[s+1][t]&&e[s+2][t]&&(null===(h=e[s][t])||void 0===h?void 0:h.texture.key)===(null===(n=e[s+1][t])||void 0===n?void 0:n.texture.key)&&(null===(a=e[s+1][t])||void 0===a?void 0:a.texture.key)===(null===(l=e[s+2][t])||void 0===l?void 0:l.texture.key)&&(d.length>0&&-1==d.indexOf(e[s][t])&&(o.push(d),d=[]),-1==d.indexOf(e[s][t])&&d.push(e[s][t]),-1==d.indexOf(e[s+1][t])&&d.push(e[s+1][t]),-1==d.indexOf(e[s+2][t])&&d.push(e[s+2][t]));d.length>0&&o.push(d)}return o}resetTimeHintAndIdle(){this.timeSinceInteraction=0,this.timeSinceIdle=0}destroyAllTiles(e){return new Promise((t=>{var i,s;for(let e=0;e<this.tileGrid.length;e++)for(let t=0;t<this.tileGrid[e].length;t++)this.tileGrid[e][t]&&(null===(i=this.tileGrid[e][t])||void 0===i||i.destroy());this.tileGrid=[],null===(s=this.currentSelectionImage)||void 0===s||s.destroy(),this.currentSelectionImage=void 0,this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.resetTimeHintAndIdle(),e&&e(),t()}))}}const T=m;class y extends Phaser.GameObjects.Container{constructor(e,t,i,s){super(e,t,i),this.targetScore=s,this.currentScore=0,this.progressBar=new Phaser.GameObjects.Image(e,60,58,"bar_1").setOrigin(0,0),this.progressFill=new Phaser.GameObjects.Image(e,63,61,"bar_2").setOrigin(0,0),this.boardTarget=new Phaser.GameObjects.Image(e,320,20,"f").setOrigin(0,0),this.targetText=e.add.text(348,35,"Target",{fontFamily:"Arial",fontSize:"28px",color:"#ff4500",strokeThickness:6}),this.targetText.setOrigin(0,0),this.targetScoreText=e.add.text(357,70,`${s}`,{fontFamily:"Arial",fontSize:"28px",color:"#ff4500",strokeThickness:6}),this.targetScoreText.setOrigin(0,0),this.scoreText=e.add.text(150,90,`${this.currentScore}`,{fontFamily:"Arial",fontSize:"26px",color:"#ff4500",strokeThickness:6}),this.emitter=this.scene.add.particles(this.progressFill.x,this.progressFill.y,"flares",{y:{min:0,max:22},frame:["red","yellow","green"],lifespan:300,speedX:{min:-150,max:0},scale:{start:.2,end:0},blendMode:"ADD"}),this.progressBar.setScale(.11),this.progressFill.setScale(.107,.09),this.boardTarget.setScale(.09),this.add(this.boardTarget),this.add(this.progressBar),this.add(this.progressFill),this.add(this.targetText),this.add(this.targetScoreText),this.add(this.scoreText),this.add(this.emitter),e.add.existing(this)}updateScore(e){this.currentScore=e,this.scoreText.setText(`${this.currentScore}`)}setTargetScore(e){this.targetScore=e,this.targetScoreText.setText(`${this.targetScore}`)}setProgressBarValue(e){const t=.107*e;this.scene.add.tween({targets:this.progressFill,scaleX:t,ease:"Linear",duration:1e3,repeat:0,yoyo:!1,onUpdate:()=>{this.emitter.x=this.progressFill.x+this.progressFill.displayWidth,0==e?this.emitter.stop():this.emitter.start()}})}}const S=y;class v extends Phaser.GameObjects.Container{constructor(e,t,i){super(e,t,i),this.init(),e.add.existing(this)}init(){this.popUpBackground=new Phaser.GameObjects.Image(this.scene,0,0,"f").setOrigin(0),this.popUpBackground.setScale(.2),this.field=new Phaser.GameObjects.Image(this.scene,0,0,"field").setOrigin(0),this.field.setScale(.25),this.field.setPosition(this.popUpBackground.displayWidth/2-this.field.displayWidth/2,this.popUpBackground.displayHeight/1.6),this.jellyYellow=new Phaser.GameObjects.Image(this.scene,0,0,"jellyYellow").setOrigin(0),this.jellyYellow.setScale(.8),this.jellyYellow.setPosition(this.popUpBackground.displayWidth/2-this.jellyYellow.displayWidth/2,this.popUpBackground.displayHeight/2-this.jellyYellow.displayHeight/2),this.jellyRed=new Phaser.GameObjects.Image(this.scene,0,0,"jellyRed").setOrigin(0),this.jellyRed.setScale(.8),this.jellyRed.setPosition(this.field.x,this.popUpBackground.displayHeight/2-this.jellyRed.displayHeight/2),this.jellyGreen=new Phaser.GameObjects.Image(this.scene,0,0,"jellyGreen").setOrigin(0),this.jellyGreen.setScale(.8),this.jellyGreen.setPosition(this.field.x+this.field.displayWidth-this.jellyGreen.displayWidth,this.popUpBackground.displayHeight/2-this.jellyGreen.displayHeight/2),this.contentText=this.scene.add.text(32,30,"LEVEL COMPLETE",{fontFamily:"Arial",fontSize:"28px",color:"#ff4500",strokeThickness:6}),this.scoreText=this.scene.add.text(0,0,`Score: ${o.getInstance().getCurrentScore()}`,{fontFamily:"Arial",fontSize:"28px",color:"#ff4500",strokeThickness:6}),this.scoreText.setPosition(this.popUpBackground.displayWidth/2-this.scoreText.width/2,this.popUpBackground.displayHeight/2+this.scoreText.height-4),this.add(this.popUpBackground),this.add(this.field),this.add(this.jellyYellow),this.add(this.jellyGreen),this.add(this.jellyRed),this.add(this.contentText),this.add(this.scoreText)}}const x=v;class w extends Phaser.GameObjects.Container{constructor(e,t,i){super(e,t,i),this.overlay=this.scene.add.graphics(),this.overlay.fillStyle(0,.7),this.overlay.fillRect(0,0,this.scene.game.config.width,this.scene.game.config.height),this.overlay.setDepth(1),this.add(this.overlay),e.add.existing(this)}}const B=w;class I extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.isPlaying=!0,this.particleEmitter=null,o.getInstance().eventEmitter.on("addScore",(e=>{this.addScoreAndUpdateMainUI(e)})),o.getInstance().eventEmitter.on("reachTargetScore",(()=>{this.updateNewRound()}))}init(){this.background=new n(this,0,0),this.gameBoard=new T(this,100,150),this.gameBoard.init(),this.gameBoard.setScale(s.scale),this.mainUI=new S(this,0,0,1e3),this.mainUI.setProgressBarValue(o.getInstance().getProgressRatio());const e=this.add.particles(100,300,"leaf",{lifespan:2e3,angle:{min:-90,max:-30},gravityY:100,speed:200,scale:.2});e.update((e=>{e.x=0})),e.explode(1)}addScoreAndUpdateMainUI(e){if(this.isPlaying){o.getInstance().incrementScore(e);const t=o.getInstance().getProgressRatio();this.mainUI.updateScore(o.getInstance().getCurrentScore()),this.mainUI.setProgressBarValue(t)}}updateNewRound(){return e=this,t=void 0,r=function*(){return new Promise((e=>{this.milestonesUI=new x(this,0,0),this.milestonesUI.setPosition(s.sizeBackgroundWidth*s.scale/2-60,s.sizeBackgroundHeight*s.scale/2).setDepth(2),this.overlay=new B(this,0,0),o.getInstance().resetScore(),this.mainUI.updateScore(o.getInstance().getCurrentScore()),this.mainUI.setProgressBarValue(o.getInstance().getProgressRatio()),this.isPlaying=!1,this.gameBoard.setIsPlaying(!1),e()})).then((()=>{setTimeout((()=>{this.milestonesUI.destroy(),this.overlay.destroy(),this.gameBoard.restart();const e=o.getInstance().getTargetScore()+1e3;o.getInstance().setTargetScore(e),this.mainUI.setTargetScore(e),this.isPlaying=!0}),2e3)}))},new((i=void 0)||(i=Promise))((function(s,h){function n(e){try{l(r.next(e))}catch(e){h(e)}}function a(e){try{l(r.throw(e))}catch(e){h(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,a)}l((r=r.apply(e,t||[])).next())}));var e,t,i,r}}const G={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"0.0.1",width:s.sizeBackgroundWidth,height:s.sizeBackgroundHeight,type:Phaser.AUTO,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.Center.CENTER_BOTH},parent:"game",scene:[r,I],render:{pixelArt:!1,antialias:!0}};class H extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new H(G)}))}},i={};function s(e){var r=i[e];if(void 0!==r)return r.exports;var h=i[e]={exports:{}};return t[e].call(h.exports,h,h.exports,s),h.exports}s.m=t,e=[],s.O=(t,i,r,h)=>{if(!i){var n=1/0;for(d=0;d<e.length;d++){for(var[i,r,h]=e[d],a=!0,l=0;l<i.length;l++)(!1&h||n>=h)&&Object.keys(s.O).every((e=>s.O[e](i[l])))?i.splice(l--,1):(a=!1,h<n&&(n=h));if(a){e.splice(d--,1);var o=r();void 0!==o&&(t=o)}}return t}h=h||0;for(var d=e.length;d>0&&e[d-1][2]>h;d--)e[d]=e[d-1];e[d]=[i,r,h]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var r,h,[n,a,l]=i,o=0;if(n.some((t=>0!==e[t]))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(l)var d=l(s)}for(t&&t(i);o<n.length;o++)h=n[o],s.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return s.O(d)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var r=s.O(void 0,[96],(()=>s(818)));r=s.O(r)})();